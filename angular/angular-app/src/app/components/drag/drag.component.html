<!-- <div class="speeddial-linear-demo">
    <p-speedDial [model]="items" direction="top-left" buttonClassName="p-button-success" styleClass="speed-dial">
    </p-speedDial>
</div> -->

<!-- <p-blockUI [blocked]="blocked" [target]="comp"></p-blockUI> -->
<!-- <div *ngIf="spinner==true" class="spinner-border text-primary text-center" role="status">
    <span class="sr-only">Loading...</span>
</div> -->
<div id="comp" class="row-1 container-fluid shadow p-1 mb-1 bg-white rounded mx-auto">
    <div>
        <!-- <p-toast position="bottom-center" [baseZIndex]="5000"></p-toast> -->
        <p-dialog [draggable]="true" [(visible)]="spinner" [showHeader]="false" [blockScroll]="true"
            contentStyleClass="mask-dialog" [closable]="false" [modal]="true" [style]="{color: '#000000'}">
            <div class="loader-body">
                <div class="loading">
                    <div class="circle cyan"></div>
                    <div class="circle magenta"></div>
                    <div class="circle yellow"></div>
                    <p class="paragraph">Running...</p>
                </div>
            </div>
        </p-dialog>

        <!-- <p-toast position="top-right"></p-toast> -->
        <p-dialog header="HELP FOR USING APPLICATION" [draggable]="true" [(visible)]="info" [modal]="false"
            [style]="{width: '50vw'}" position="bottom-right" [resizable]="true">

            <div class="accordion" id="accordionExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            1.Configure the network topology
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                        data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            The first step is to graph the nodes and quantum connections of the quantum network.
                            Drag and drop components from the
                            left-side toolbox to create the topology graph.
                            Furthermore, you can modify the settings of every component by clicking on it.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            2.Set the parameters for the application
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                        data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            The parameters of every application determine the requests that network will have to
                            fulfill in order to successfully
                            execute the application.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            3.Run the application and get Results
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                        data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            Now, you can run the application and fetch the statistics and results for a run of the
                            simulator.
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <hr>
            <ul>
                <li><strong>Service Node:</strong> This is the Quantum Router with quantum circuits and bell state
                    analyzers
                </li>
                <li><strong>End Node:</strong> This is the end user node where requests originate from.</li>
                <li><strong>Quantum Connection:</strong> These are optical channels using which entanglements are shared
                </li>
            </ul>
            <ng-template pTemplate="footer">
                <p-button icon="pi pi-check" (click)="info=false" label="Ok" styleClass="p-button-text"></p-button>
            </ng-template>
        </p-dialog>

        <div *ngIf="!spinner" style="width: 99%; display: flex;gap:3px;">
            <div id="myPaletteDiv" class="col-4" class="palette"
                style="width: 120px; background-color: white; border: outset 1px black">
            </div>
            <div id="myDiagramDiv" class="col-8 diagram" style=" height:
                calc(100vh - 100px);width:50vw; border: outset 1px black">
            </div>
            <div class="col">
                <div class="configuration" style="height:100%">
                    <h4 class="text-dark text-center">Selected Application: {{application}}</h4>
                    <p-breadcrumb [model]="breadcrumbItems"></p-breadcrumb>

                    <div *ngIf="activeIndex == 0">
                        <br>
                        <h5 style="padding-left: 1rem;">
                            Step 1: Setup Topology
                        </h5>
                        <div class="text-center">
                            <br>
                            <br>
                            <p-checkbox [(ngModel)]="checked" [binary]="true" (onChange)="preloadTopology()"
                                inputId="binary"></p-checkbox>&nbsp;<b>Use our preconfigured topology,
                                <br></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b *ngIf="!checked">or follow the
                                steps.</b>
                        </div>
                        <br>
                        <div *ngIf="!checked">
                            <ol style="padding-left: 4rem">

                                <li>
                                    <p>
                                        Please drag a component from the palette.
                                    </p>
                                </li>

                                <li>
                                    <p>
                                        Please drag your pointer from node to node to create a connection.
                                    </p>
                                </li>
                            </ol>
                        </div>
                        <br>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-primary" (click)="activeindex('next')">Next</button>
                        </div>

                    </div>
                    <div id="step2" *ngIf="activeIndex == 1">
                        <h5>
                            Step 2: Configuration
                        </h5>
                        <ol>
                            <li>
                                Click on Component to configure its settings.
                            </li>
                        </ol>
                        <form [formGroup]="toolbox">
                            <h6 class="text-center text-black" *ngIf="nodeParams">
                                <u>Node</u>
                            </h6>
                            <div class="form-group col-8 mx-auto" *ngIf="nodeParams">
                                <label for="name" class="form-label mx-auto">Name</label>
                                <input type="email" class="form-control mx-auto" id="name" formControlName="name"
                                    aria-describedby="emailHelp" placeholder="Enter Name">
                                <!-- <small class="text-muted">Name of the selected node</small> -->
                            </div>
                            <div class="form-group col-8 mx-auto" *ngIf="nodeParams">
                                <label for="noOfMemories" class="form-label mx-auto">No of Memories</label>
                                <input type="number" class="form-control mx-auto" id="noOfMemories"
                                    formControlName="noOfMemories" placeholder="No of Memories">
                                <!-- <small class="text-muted">No of Memories</small> -->
                            </div>
                            <br>
                            <div class="d-flex justify-content-center" *ngIf="nodeParams">
                                <button class="btn btn-primary" (click)="add()">Save</button>
                            </div>

                            <h6 class="text-center text-black">
                                <u>Connections</u>
                            </h6>
                            <div class="form-group col-8 mx-auto">
                                <label for="attenuation" class="form-label mx-auto">Attenuation</label>
                                <input type="number" class="form-control" formControlName="attenuation" id="attenuation"
                                    placeholder="Enter in decimals">
                                <!-- <div class="text-muted">attenuation of Optical channel's fiber (in dB/m).</div> -->
                            </div>
                            <div class="form-group col-8 mx-auto">
                                <label for="distance" class="form-label mx-auto">Link Length</label>
                                <input type="number" class="form-control mx-auto" id="distance"
                                    formControlName="distance" placeholder="Enter Distance">
                                <!-- <div class="text-muted">length of the fiber (in km)</div> -->
                            </div>
                            <br>
                            <div class="d-flex justify-content-center">
                                <button class="btn btn-primary" (click)="activeindex('next')">Next</button>
                            </div>
                            <br>
                        </form>
                    </div>
                    <div *ngIf="activeIndex == 2">
                        <h5>
                            Step 3: Application Parameters
                        </h5>
                        <form [formGroup]="appSettingsForm">
                            <h5 class="text-center mt-1">Application Settings</h5>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id != 4">
                                <label for="type" class="form-label font-bold">
                                    Sender
                                </label>
                                <select class="form-control" formControlName="sender">
                                    <option *ngFor="let data of endNodes" [ngValue]="data.Name">{{data.Name}}</option>
                                </select>
                                <div *ngIf="endNodes.length ==0">
                                    <p class="text-danger">
                                        Please drag a end node and configure it.
                                    </p>
                                </div>
                                <div *ngIf="sender.touched && sender.invalid">
                                    <div *ngIf="sender.errors.required">
                                        <p class="text-danger">Please select an Sender.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id != 4">
                                <label for="type" class="form-label font-bold">
                                    Receiver
                                </label>
                                <select class="form-control" formControlName="receiver">
                                    <option *ngFor="let data of endNodes" [ngValue]="data.Name">{{data.Name}}</option>
                                </select>
                                <div *ngIf="endNodes.length ==0">
                                    <p class="text-danger">
                                        Please drag a end node and configure it.
                                    </p>
                                </div>
                                <div *ngIf="receiver.touched && receiver.invalid">
                                    <div *ngIf="receiver.errors.required">
                                        <p class="text-danger">Please select an Receiver.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 1">
                                <label for="type" class="form-label font-bold">
                                    Key Length
                                </label>
                                <input type="number" min="1" oninput="this.value = Math.abs(this.value)"
                                    formControlName="keyLength" class="form-control">
                                <div *ngIf="keyLength.touched && keyLength.invalid">
                                    <div *ngIf="keyLength.errors.required">
                                        <p class="text-danger">Please enter key length.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 2">
                                <label for="type" class="form-label font-bold">
                                    Target Fidelity: {{e2e.targetFidelity}}
                                </label>
                                <br>
                                <p-slider formControlName="targetFidelity" [min]="0" [step]="0.05" [max]="1"
                                    (onSlideEnd)="e2eChange('target')"></p-slider>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 2">
                                <label class="form-label">
                                    Demand: {{e2e.size}}
                                </label>
                                <br>
                                <p-slider formControlName="size" [min]="0" [step]="1" [max]="6"
                                    (onSlideEnd)="e2eChange('size')"></p-slider>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 2">
                                <label for="timeout" class="col-12">TimeOut (e12)</label>
                                <input type="text" class="form-control col-12"
                                    aria-label="Amount (to the nearest dollar)" formControlName="timeout">
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 5 || app_id == 6">
                                <label for="type" class="form-label font-bold">
                                    Sequence Length
                                </label>
                                <input type="number" min="1" oninput="this.value = Math.abs(this.value)"
                                    formControlName="sequenceLength" class="form-control">
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 3">
                                <label for="endNode">Random Qubit Amplitude 1</label>&nbsp;
                                <input type="text" class="form-control" formControlName="amplitude1">
                                <div class="text-muted">Random Single Qubit's amplitude at |0></div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 3">
                                <label for="endNode">Random Qubit Amplitude 1</label>&nbsp;
                                <input type="text" class="form-control" formControlName="amplitude2">
                                <div class="text-muted">Random Single Qubit's amplitude at |0></div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 4">
                                <label for="type" class="form-label font-bold">
                                    End Node 1
                                </label>
                                <select class="form-control" formControlName="endnode1">
                                    <option *ngFor="let data of endNodes" [ngValue]="data.Name">{{data.Name}}</option>
                                </select>
                                <div *ngIf="node1.touched && node1.invalid">
                                    <div *ngIf="node1.errors.required">
                                        <p class="text-danger">Please select End Node 1.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 4">
                                <label for="type" class="form-label font-bold">
                                    End Node 2
                                </label>
                                <select class="form-control" formControlName="endnode2">
                                    <option *ngFor="let data of endNodes" [ngValue]="data.Name">{{data.Name}}</option>
                                </select>
                                <div *ngIf="node2.touched && node2.invalid">
                                    <div *ngIf="node2.errors.required">
                                        <p class="text-danger">Please select End Node 2.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 4">
                                <label for="type" class="form-label font-bold">
                                    End Node 3
                                </label>
                                <select class="form-control" formControlName="endnode3">
                                    <option *ngFor="let data of endNodes" [ngValue]="data.Name">{{data.Name}}</option>
                                </select>
                                <div *ngIf="node3.touched && node3.invalid">
                                    <div *ngIf="node3.errors.required">
                                        <p class="text-danger">Please select End Node 3.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 4">
                                <label for="type" class="form-label font-bold">
                                    Central Node
                                </label>
                                <select class="form-control" formControlName="middleNode"
                                    (change)="selectReceiver($event)">
                                    <option *ngFor="let data of serviceNodes" [ngValue]="data.Name">{{data.Name}}
                                    </option>
                                </select>
                                <div *ngIf="middlenode.touched && middlenode.invalid">
                                    <div *ngIf="middlenode.errors.required">
                                        <p class="text-danger">Please select an Central Node.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 6 || app_id == 5 || app_id == 9">
                                <label for="type" class="form-label font-bold">
                                    Message
                                </label>
                                <input type="text" (keypress)="allowBitsInput($event)" formControlName="message"
                                    class="form-control">
                                <div
                                    *ngIf="appSettingsForm.get('message').touched && appSettingsForm.get('message').invalid">
                                    <div *ngIf="appSettingsForm.get('message').errors.required">
                                        <p class="text-danger">Message is required.</p>
                                    </div>
                                    <div *ngIf="appSettingsForm.get('message').errors.evenLength">
                                        <p class="text-danger">Message must have an even number of characters</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 8">
                                <label for="type" class="form-label font-bold">
                                    Sender's Message
                                </label>
                                <input type="text" formControlName="message1" class="form-control">
                                <div
                                    *ngIf="appSettingsForm.get('message1').touched && appSettingsForm.get('message1').invalid">
                                    <div *ngIf="appSettingsForm.get('message1').errors.required">
                                        <p class="text-danger">Sender's Message is required.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 col-9 mx-auto" *ngIf="app_id == 8">
                                <label for="type" class="form-label font-bold">
                                    Receiver's Message
                                </label>
                                <input type="text" formControlName="message2" class="form-control">
                                <div
                                    *ngIf="appSettingsForm.get('message2').touched && appSettingsForm.get('message2').invalid">
                                    <div *ngIf="appSettingsForm.get('message2').errors.required">
                                        <p class="text-danger">Receiver's Message is required.</p>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <br>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-primary btn-custom btn-sm" (click)="parameters()">Run
                                Application</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"
            rejectButtonStyleClass="p-button-text"></p-confirmDialog>
        <div *ngIf="step == 1" id="tutorial1" class="body1">
            <div class="d-flex">
                <h6>You can drag and drop an object to start building topology.
                </h6>
            </div>
            <div class="d-flex justify-content-end align-items-end btn-custom1">
                <button class="btn btn-primary-sm btn-custom" (click)="next(2)">Next</button>
            </div>
        </div>

    </div>